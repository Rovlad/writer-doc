{% extends "base.html" %}
{% block title %}–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç ‚Äî –°–ª–æ–≤–∞—Ä—å –ü–∏—Å–∞—Ç–µ–ª—è{% endblock %}

{% block content %}
<div class="upload-page">
    <div class="upload-card">
        <h2 class="upload-title">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª</h2>
        <p class="upload-hint">–ü—Ä–æ–∑–∞, –ø–æ—ç–∑–∏—è, —Å–±–æ—Ä–Ω–∏–∫–∏ ‚Äî —Ñ–∞–π–ª .txt –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ UTF-8 –∏–ª–∏ Windows-1251</p>

        <form action="{{ url_for('analyze') }}" method="POST" enctype="multipart/form-data" id="uploadForm">
            <div class="dropzone" id="dropzone">
                <input type="file" name="file" id="fileInput" accept=".txt" hidden>
                <div class="dropzone-icon">üìÑ</div>
                <p class="dropzone-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ .txt —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ <span class="dropzone-link">–≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</span></p>
                <span class="dropzone-hint">–ú–∞–∫—Å–∏–º—É–º 16 –ú–ë</span>
                <div class="dropzone-file" id="fileInfo" style="display:none">
                    <span class="file-badge" id="fileName"></span>
                    <span class="file-size" id="fileSize"></span>
                    <button type="button" class="file-clear" id="fileClear">‚úï</button>
                </div>
            </div>

            <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
                –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç ‚Üí
            </button>
        </form>

        <div class="loading-overlay" id="loadingOverlay" style="display:none">
            <div class="spinner"></div>
            <p class="loading-text">–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ–∫—É–Ω–¥ –¥–æ –º–∏–Ω—É—Ç—ã‚Ä¶</p>
            <p class="loading-hint">–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π ¬∑ –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è ¬∑ –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è ¬∑ –°–∏–Ω—Ç–∞–∫—Å–∏—Å ¬∑ –°–ª–æ–≤–∞—Ä—å</p>
        </div>
    </div>

    <div class="features-grid">
        <div class="feature-card">
            <span class="feature-icon">üìñ</span>
            <strong>–°–ª–æ–≤–∞—Ä—å</strong>
            <span class="feature-desc">–õ–µ–º–º—ã, —Ñ–æ—Ä–º—ã, —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å</span>
        </div>
        <div class="feature-card">
            <span class="feature-icon">üìä</span>
            <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</strong>
            <span class="feature-desc">–¢–æ–ø-100 —Å—É—â., –ø—Ä–∏–ª., –≥–ª–∞–≥–æ–ª–æ–≤</span>
        </div>
        <div class="feature-card">
            <span class="feature-icon">üîó</span>
            <strong>–°–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è</strong>
            <span class="feature-desc">–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–º</span>
        </div>
        <div class="feature-card">
            <span class="feature-icon">üîç</span>
            <strong>–ü–æ–∏—Å–∫</strong>
            <span class="feature-desc">–í–≤–µ–¥–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ ‚Üí –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ</span>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const dropzone = document.getElementById('dropzone');
const fileInput = document.getElementById('fileInput');
const fileInfo = document.getElementById('fileInfo');
const fileName = document.getElementById('fileName');
const fileSize = document.getElementById('fileSize');
const fileClear = document.getElementById('fileClear');
const submitBtn = document.getElementById('submitBtn');
const form = document.getElementById('uploadForm');
const overlay = document.getElementById('loadingOverlay');

dropzone.addEventListener('click', () => fileInput.click());
dropzone.addEventListener('dragover', e => { e.preventDefault(); dropzone.classList.add('dragover'); });
dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
dropzone.addEventListener('drop', e => {
    e.preventDefault();
    dropzone.classList.remove('dragover');
    if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        showFile(e.dataTransfer.files[0]);
    }
});

fileInput.addEventListener('change', () => {
    if (fileInput.files.length) showFile(fileInput.files[0]);
});

fileClear.addEventListener('click', e => {
    e.stopPropagation();
    fileInput.value = '';
    fileInfo.style.display = 'none';
    submitBtn.disabled = true;
});

function showFile(file) {
    fileName.textContent = file.name;
    fileSize.textContent = (file.size / 1024).toFixed(1) + ' –ö–ë';
    fileInfo.style.display = 'flex';
    submitBtn.disabled = false;
}

form.addEventListener('submit', () => {
    overlay.style.display = 'flex';
    submitBtn.disabled = true;
    submitBtn.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞‚Ä¶';
});
</script>
{% endblock %}
