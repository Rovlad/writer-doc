{% extends "base.html" %}
{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Äî {{ filename }}{% endblock %}

{% block content %}
<div class="results-page">

    <!-- ‚îÄ‚îÄ Summary Bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="summary-bar">
        <div class="summary-left">
            <span class="summary-file">üìÑ {{ filename }}</span>
            <span class="summary-time">–û–±—Ä–∞–±–æ—Ç–∫–∞: {{ result.meta.processing_time_sec }} —Å–µ–∫</span>
        </div>
        <div class="summary-stats">
            <div class="stat-chip"><span class="stat-num">{{ result.statistics.total_words }}</span><span class="stat-label">—Å–ª–æ–≤</span></div>
            <div class="stat-chip"><span class="stat-num">{{ result.statistics.unique_lemmas }}</span><span class="stat-label">–ª–µ–º–º</span></div>
            <div class="stat-chip"><span class="stat-num">{{ result.statistics.vocabulary_richness }}%</span><span class="stat-label">–±–æ–≥–∞—Ç—Å—Ç–≤–æ</span></div>
            <div class="stat-chip"><span class="stat-num">{{ result.collocations.unique_pairs }}</span><span class="stat-label">—Å–ª–æ–≤–æ—Å–æ—á.</span></div>
        </div>
        <div class="summary-actions">
            <a href="{{ url_for('api_export') }}" class="btn btn-sm">‚¨á –°–∫–∞—á–∞—Ç—å JSON</a>
            <button class="btn btn-sm btn-accent" onclick="saveToSupabase()">üíæ –í Supabase</button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="tabs-bar">
        <button class="tab active" data-tab="statistics">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        <button class="tab" data-tab="dictionary">üìñ –°–ª–æ–≤–∞—Ä—å</button>
        <button class="tab" data-tab="collocations">üîó –°–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è</button>
        <button class="tab" data-tab="search">üîç –ü–æ–∏—Å–∫</button>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--  STATISTICS TAB                                         -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="tab-content active" id="tab-statistics">
        <div class="stats-grid">
            <!-- General stats -->
            <div class="stats-card">
                <h3 class="stats-card-title">–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="stats-rows">
                    <div class="stats-row"><span>–í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤</span><strong>{{ result.statistics.total_tokens }}</strong></div>
                    <div class="stats-row"><span>–°–ª–æ–≤ (–±–µ–∑ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏)</span><strong>{{ result.statistics.total_words }}</strong></div>
                    <div class="stats-row"><span>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ª–µ–º–º</span><strong>{{ result.statistics.unique_lemmas }}</strong></div>
                    <div class="stats-row"><span>–ë–æ–≥–∞—Ç—Å—Ç–≤–æ —Å–ª–æ–≤–∞—Ä—è</span><strong>{{ result.statistics.vocabulary_richness }}%</strong></div>
                    <div class="stats-row"><span>–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Å–ª–æ–≤–∞</span><strong>{{ result.statistics.avg_word_length }} –±—É–∫–≤</strong></div>
                </div>
            </div>

            <!-- POS distribution -->
            <div class="stats-card">
                <h3 class="stats-card-title">–ß–∞—Å—Ç–∏ —Ä–µ—á–∏</h3>
                <div class="pos-chart">
                    {% set max_pos = result.statistics.pos_distribution.values()|max if result.statistics.pos_distribution else 1 %}
                    {% for pos, count in result.statistics.pos_distribution.items() %}
                    <div class="pos-row">
                        <span class="pos-label">{{ result.statistics.pos_labels_ru.get(pos, pos) }}</span>
                        <div class="pos-bar-wrap">
                            <div class="pos-bar" style="width: {{ (count / max_pos * 100)|round }}%"></div>
                        </div>
                        <span class="pos-count">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Top-100 tables -->
        <h3 class="section-title">–¢–æ–ø-100 –ø–æ —á–∞—Å—Ç—è–º —Ä–µ—á–∏</h3>
        <div class="top-tables-grid">
            {% for key, label in [('top_nouns', '–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ'), ('top_adj', '–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ'), ('top_verbs', '–ì–ª–∞–≥–æ–ª—ã'), ('top_adv', '–ù–∞—Ä–µ—á–∏—è')] %}
            <div class="top-table-card">
                <h4 class="top-table-title">{{ label }}</h4>
                <div class="top-table-scroll">
                    <table class="top-table">
                        <thead><tr><th>#</th><th>–õ–µ–º–º–∞</th><th>–ß–∞—Å—Ç–æ—Ç–∞</th></tr></thead>
                        <tbody>
                        {% for entry in result.statistics[key][:100] %}
                        <tr>
                            <td class="rank">{{ loop.index }}</td>
                            <td class="lemma">{{ entry.lemma }}</td>
                            <td class="count">{{ entry.count }}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--  DICTIONARY TAB                                         -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="tab-content" id="tab-dictionary">
        <div class="toolbar">
            <input type="text" id="dictSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –ª–µ–º–º–µ‚Ä¶" class="input">
            <select id="dictPosFilter" class="select">
                <option value="all">–í—Å–µ —á–∞—Å—Ç–∏ —Ä–µ—á–∏</option>
                <option value="NOUN">–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ</option>
                <option value="ADJ">–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ</option>
                <option value="VERB">–ì–ª–∞–≥–æ–ª—ã</option>
                <option value="ADV">–ù–∞—Ä–µ—á–∏—è</option>
                <option value="PROPN">–ò–º–µ–Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ</option>
            </select>
        </div>
        <div class="dict-table-wrap">
            <table class="dict-table" id="dictTable">
                <thead>
                    <tr>
                        <th>–õ–µ–º–º–∞</th>
                        <th>–ß–∞—Å—Ç—å —Ä–µ—á–∏</th>
                        <th>–ß–∞—Å—Ç–æ—Ç–∞</th>
                        <th>–§–æ—Ä–º—ã –≤ —Ç–µ–∫—Å—Ç–µ</th>
                        <th>–ü—Ä–∏–º–µ—Ä</th>
                    </tr>
                </thead>
                <tbody>
                {% for entry in result.dictionary %}
                <tr data-pos="{{ entry.pos }}" data-lemma="{{ entry.lemma }}">
                    <td class="lemma-cell"><strong>{{ entry.lemma }}</strong></td>
                    <td><span class="pos-badge">{{ entry.pos }}</span></td>
                    <td class="count-cell">{{ entry.count }}</td>
                    <td class="forms-cell">{{ entry.surface_forms | join(', ') }}</td>
                    <td class="example-cell">{{ entry.example }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--  COLLOCATIONS TAB                                       -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="tab-content" id="tab-collocations">
        <p class="tab-intro">
            –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–≥–æ ‚Äî –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ —Ç–µ–∫—Å—Ç–µ —Ä—è–¥–æ–º —Å –Ω–∏–º
            (—á–µ—Ä–µ–∑ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –æ–∫–Ω–æ ¬±2 —Ç–æ–∫–µ–Ω–∞).
        </p>
        <div class="coll-grid">
            {% for noun, adjs in result.collocations.noun_adj_index.items() | sort(attribute='0') %}
            {% if adjs | length >= 1 %}
            <div class="coll-card">
                <div class="coll-noun">{{ noun }}</div>
                <div class="coll-adjs">
                    {% for a in adjs[:10] %}
                    <span class="coll-adj-tag" title="√ó{{ a.count }}{% if a.examples %} ‚Äî {{ a.examples[0] }}{% endif %}">
                        {{ a.adj }} <small>√ó{{ a.count }}</small>
                    </span>
                    {% endfor %}
                    {% if adjs | length > 10 %}
                    <span class="coll-more">+{{ adjs | length - 10 }} –µ—â—ë</span>
                    {% endif %}
                </div>
                {% if adjs[0].examples %}
                <div class="coll-example">¬´{{ adjs[0].examples[0] }}¬ª</div>
                {% endif %}
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--  SEARCH TAB                                             -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="tab-content" id="tab-search">
        <div class="search-section">
            <h3 class="search-title">–ù–∞–π—Ç–∏ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–º—É</h3>
            <p class="search-hint">–í–≤–µ–¥–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ –≤ –Ω–∞—á–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ (–ª–µ–º–º—É), –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º —Å–ª–æ–≤–æ–º –≤ —Ç–µ–∫—Å—Ç–µ.</p>
            <div class="search-row">
                <input type="text" id="nounInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¥—É—à–∞, –º–æ—Ä–µ, –Ω–æ—á—å ‚Ä¶" class="input input-lg">
                <button class="btn btn-primary" id="searchBtn" onclick="searchNoun()">–ù–∞–π—Ç–∏ ‚Üí</button>
            </div>
            <div id="searchResults" class="search-results"></div>
        </div>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
{% endblock %}
